<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Preview - Acadrive</title>
    <!-- Use the same CDN as your main page -->
    <script src="https://mozilla.github.io/pdf.js/build/pdf.mjs" type="module"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Keep your existing CSS styles */
        body { font-family: sans-serif; margin: 0; background-color: #525659; display: flex; flex-direction: column; height: 100vh; }
        #top-bar { background-color: #333; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.5); z-index: 10; }
        #top-bar span { font-size: 1.2rem; }
        #top-bar .controls button, #download-btn { background-color: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        #pdf-container { flex-grow: 1; text-align: center; overflow: auto; padding: 20px; }
        canvas { border: 1px solid black; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <!-- Keep your existing HTML structure -->
    <div id="top-bar">
        <span id="filename">Loading...</span>
        <div class="controls">
            <button id="prev-page">Previous</button>
            <span id="page-num"></span> / <span id="page-count"></span>
            <button id="next-page">Next</button>
            <button id="download-btn">Download</button>
        </div>
    </div>

    <div id="pdf-container">
        <canvas id="pdf-canvas"></canvas>
    </div>

    <script type="module">
        // Your existing preview JavaScript code
        const { pdfjsLib } = globalThis;
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://mozilla.github.io/pdf.js/build/pdf.worker.mjs`;

        // Get the PDF file URL from the page's address
        const urlParams = new URLSearchParams(window.location.search);
        const pdfUrl = urlParams.get('file');
        const pdfName = pdfUrl ? pdfUrl.split('/').pop() : 'Document';

        document.getElementById('filename').textContent = pdfName;
        const downloadBtn = document.getElementById('download-btn');

        let pdfDoc = null,
            pageNum = 1,
            pageIsRendering = false,
            pageNumIsPending = null;

        const scale = 1.5,
              canvas = document.getElementById('pdf-canvas'),
              ctx = canvas.getContext('2d');

        // Rest of your existing preview JavaScript...
        const renderPage = num => {
            pageIsRendering = true;
            pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                const renderCtx = { canvasContext: ctx, viewport };
                page.render(renderCtx).promise.then(() => {
                    pageIsRendering = false;
                    if (pageNumIsPending !== null) {
                        renderPage(pageNumIsPending);
                        pageNumIsPending = null;
                    }
                });
                document.getElementById('page-num').textContent = num;
            });
        };

        const queueRenderPage = num => {
            if (pageIsRendering) {
                pageNumIsPending = num;
            } else {
                renderPage(num);
            }
        };

        const showPrevPage = () => {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        };

        const showNextPage = () => {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        };

        downloadBtn.addEventListener('click', () => {
            fetch(pdfUrl)
                .then(res => res.blob())
                .then(blob => {
                    const tempUrl = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = tempUrl;
                    a.download = pdfName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(tempUrl);
                });
        });

        if (pdfUrl) {
            pdfjsLib.getDocument(pdfUrl).promise.then(doc => {
                pdfDoc = doc;
                document.getElementById('page-count').textContent = pdfDoc.numPages;
                renderPage(pageNum);
            }).catch(err => {
                console.error(`Error loading PDF: ${err.message}`);
                alert(`Error loading PDF. Please check the browser console for more details.`);
            });
        }

        document.getElementById('prev-page').addEventListener('click', showPrevPage);
        document.getElementById('next-page').addEventListener('click', showNextPage);
    </script>
</body>
</html>